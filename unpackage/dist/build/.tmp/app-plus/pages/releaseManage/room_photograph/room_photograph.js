(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/releaseManage/room_photograph/room_photograph"],{3338:function(t,s,e){"use strict";e("83ff");var i=o(e("b0ce")),a=o(e("51bf"));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},"51bf":function(t,s,e){"use strict";e.r(s);var i=e("75f2"),a=e("62b0");for(var o in a)"default"!==o&&function(t){e.d(s,t,function(){return a[t]})}(o);e("777c"),e("76b4");var n=e("2877"),c=Object(n["a"])(a["default"],i["a"],i["b"],!1,null,"6381b73e",null);s["default"]=c.exports},"62b0":function(t,s,e){"use strict";e.r(s);var i=e("cac5"),a=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(s,t,function(){return i[t]})}(o);s["default"]=a.a},"689a":function(t,s,e){},"75f2":function(t,s,e){"use strict";var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("scroll-view",{staticClass:"contanier",attrs:{"scroll-y":!t.setMainPicShow}},[e("view",{staticClass:"title"},[t._v("上传房源照片要求")]),e("view",{staticClass:"demand-box"},[e("text",[t._v("1.无明显修改")]),e("text",[t._v("2.无拉伸变形")]),e("text",[t._v("3.无水印")]),e("text",[t._v("4.不能出现联系方式或品牌宣传")]),e("view",{staticStyle:{color:"#F05B72"}},[t._v("5.卧室、卫生间必传,并且照片总数大于五张。")]),e("view",{staticStyle:{color:"#F05B72"}},[t._v("6.图片大小不超过20M,尺寸800*800以上,必须是png/jpg格式!!!")])]),e("view",{staticClass:"bedroom-box"},[e("view",{staticClass:"top-bedroom"},[e("text",{staticStyle:{"font-weight":"700"}},[t._v("首图")])]),e("view",{staticClass:"hint-bedroom"},[e("view",{staticStyle:{color:"#f66","margin-right":"10rpx"}},[t._v("*必须设置(请先上传房源照片)")]),e("text",{staticClass:"hint-bedroom-color"},[t._v("从上传的照片中选择一张"),e("text",{staticStyle:{color:"#f66",margin:"0 10rpx"}},[t._v("横图")]),t._v("作为首图!")])]),e("view",{staticClass:"image_wrap"},[""!==t.mainPic?e("view",{staticClass:"img_item"},[e("image",{attrs:{src:t.host+t.mainPic}}),e("view",{staticClass:"set_main",attrs:{eventid:"3f57b723-0"},on:{tap:function(s){s.stopPropagation(),t.MainPicModelShow()}}},[e("text",[t._v("切换首图")])])]):t._e(),""===t.mainPic?e("view",{staticClass:"choose_img",attrs:{eventid:"3f57b723-1"},on:{tap:function(s){s.stopPropagation(),t.MainPicModelShow()}}},[e("text",{staticClass:"iconfont icon-jia"})]):t._e()])]),e("view",{staticClass:"bedroom-box"},[e("view",{staticClass:"top-bedroom"},[e("text",{staticStyle:{"font-weight":"700"}},[t._v("卧室")]),e("view",{staticClass:"example"},[t._v("范例"),e("text",{staticClass:"iconfont"},[t._v("")])])]),e("view",{staticClass:"hint-bedroom"},[e("text",{staticStyle:{color:"#f66","margin-right":"10rpx"}},[t._v("*必须上传")]),t._v("请确保"),e("text",{staticClass:"hint-bedroom-color"},[t._v("卧室、床铺、床单、枕头展示齐全")])]),e("view",{staticClass:"image_wrap"},[t._l(t.pics,function(s,i){return t.pics.length>0&&"bedroom"===s.type?e("view",{key:i,staticClass:"img_item",attrs:{eventid:"3f57b723-3-"+i},on:{tap:function(e){e.stopPropagation(),t.previewPic(s)}}},[e("image",{attrs:{src:t.host+s.val}}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"del_img",attrs:{eventid:"3f57b723-2-"+i},on:{tap:function(s){s.stopPropagation(),t.del_img(i)}}},[e("text",{staticClass:"iconfont icon-duomeitiicon-"})]):t._e()]):t._e()}),t._l(t.temporaryUpload,function(s,i){return t.temporaryUpload.length>0&&t.isUploading&&"bedroom"===t.curUploadType?e("view",{key:s.path,staticClass:"img_item2"},[e("image",{attrs:{src:s.path}}),e("view",{staticClass:"mask"},[t.uploadErrStatus[i]&&0!=t.uploadErrStatus[i]?t._e():e("text",{staticClass:"progress"},[e("text",{staticClass:"num"},[t._v(t._s(t.progressAll[i]))]),t._v("%")]),!0===t.uploadErrStatus[i]?e("text",{staticClass:"err"},[t._v(t._s(t.errTips[i]))]):t._e()])]):t._e()}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"choose_img",attrs:{eventid:"3f57b723-4"},on:{tap:function(s){s.stopPropagation(),t.chooseImg("bedroom")}}},[e("text",{staticClass:"iconfont icon-jia"})]):t._e()],2)]),e("view",{staticClass:"bedroom-box"},[e("view",{staticClass:"top-bedroom"},[e("text",{staticStyle:{"font-weight":"700"}},[t._v("客厅")]),e("view",{staticClass:"example"},[t._v("范例"),e("text",{staticClass:"iconfont"},[t._v("")])])]),e("view",{staticClass:"hint-bedroom"},[t._v("建议上传。站在厅角拍摄，事业会更广阔。")]),e("view",{staticClass:"image_wrap"},[t._l(t.pics,function(s,i){return t.pics.length>0&&"liveroom"===s.type?e("view",{key:i,staticClass:"img_item",attrs:{eventid:"3f57b723-6-"+i},on:{tap:function(e){e.stopPropagation(),t.previewPic(s)}}},[e("image",{attrs:{src:t.host+s.val}}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"del_img",attrs:{eventid:"3f57b723-5-"+i},on:{tap:function(s){s.stopPropagation(),t.del_img(i)}}},[e("text",{staticClass:"iconfont icon-duomeitiicon-"})]):t._e()]):t._e()}),t._l(t.temporaryUpload,function(s,i){return t.temporaryUpload.length>0&&t.isUploading&&"liveroom"===t.curUploadType?e("view",{key:s.path,staticClass:"img_item2"},[e("image",{attrs:{src:s.path}}),e("view",{staticClass:"mask"},[t.uploadErrStatus[i]&&0!=t.uploadErrStatus[i]?t._e():e("text",{staticClass:"progress"},[e("text",{staticClass:"num"},[t._v(t._s(t.progressAll[i]))]),t._v("%")]),!0===t.uploadErrStatus[i]?e("text",{staticClass:"err"},[t._v(t._s(t.errTips[i]))]):t._e()])]):t._e()}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"choose_img",attrs:{eventid:"3f57b723-7"},on:{tap:function(s){s.stopPropagation(),t.chooseImg("liveroom")}}},[e("text",{staticClass:"iconfont icon-jia"})]):t._e()],2)]),e("view",{staticClass:"bedroom-box"},[e("view",{staticClass:"top-bedroom"},[e("text",{staticStyle:{"font-weight":"700"}},[t._v("卫生间")]),e("view",{staticClass:"example"},[t._v("范例"),e("text",{staticClass:"iconfont"},[t._v("")])])]),e("view",{staticClass:"hint-bedroom"},[e("text",{staticStyle:{color:"#f66","margin-right":"10rpx"}},[t._v("*必须上传")]),t._v("卫生间照片。请确保"),e("text",{staticClass:"hint-bedroom-color"},[t._v("马桶卫浴、地面细节完整。")])]),e("view",{staticClass:"image_wrap"},[t._l(t.pics,function(s,i){return t.pics.length>0&&"toilet"===s.type?e("view",{key:i,staticClass:"img_item",attrs:{eventid:"3f57b723-9-"+i},on:{tap:function(e){e.stopPropagation(),t.previewPic(s)}}},[e("image",{attrs:{src:t.host+s.val}}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"del_img",attrs:{eventid:"3f57b723-8-"+i},on:{tap:function(s){s.stopPropagation(),t.del_img(i)}}},[e("text",{staticClass:"iconfont icon-duomeitiicon-"})]):t._e()]):t._e()}),t._l(t.temporaryUpload,function(s,i){return t.temporaryUpload.length>0&&t.isUploading&&"toilet"===t.curUploadType?e("view",{key:s.path,staticClass:"img_item2"},[e("image",{attrs:{src:s.path}}),e("view",{staticClass:"mask"},[t.uploadErrStatus[i]&&0!=t.uploadErrStatus[i]?t._e():e("text",{staticClass:"progress"},[e("text",{staticClass:"num"},[t._v(t._s(t.progressAll[i]))]),t._v("%")]),!0===t.uploadErrStatus[i]?e("text",{staticClass:"err"},[t._v(t._s(t.errTips[i]))]):t._e()])]):t._e()}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"choose_img",attrs:{eventid:"3f57b723-10"},on:{tap:function(s){s.stopPropagation(),t.chooseImg("toilet")}}},[e("text",{staticClass:"iconfont icon-jia"})]):t._e()],2)]),e("view",{staticClass:"bedroom-box"},[e("view",{staticClass:"top-bedroom"},[e("text",{staticStyle:{"font-weight":"700"}},[t._v("厨房")]),e("view",{staticClass:"example"},[t._v("范例"),e("text",{staticClass:"iconfont"},[t._v("")])])]),e("view",{staticClass:"hint-bedroom"},[t._v("建议上传。")]),e("view",{staticClass:"image_wrap"},[t._l(t.pics,function(s,i){return t.pics.length>0&&"kitchen"===s.type?e("view",{key:i,staticClass:"img_item",attrs:{eventid:"3f57b723-12-"+i},on:{tap:function(e){e.stopPropagation(),t.previewPic(s)}}},[e("image",{attrs:{src:t.host+s.val}}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"del_img",attrs:{eventid:"3f57b723-11-"+i},on:{tap:function(s){s.stopPropagation(),t.del_img(i)}}},[e("text",{staticClass:"iconfont icon-duomeitiicon-"})]):t._e()]):t._e()}),t._l(t.temporaryUpload,function(s,i){return t.temporaryUpload.length>0&&t.isUploading&&"kitchen"===t.curUploadType?e("view",{key:s.path,staticClass:"img_item2"},[e("image",{attrs:{src:s.path}}),e("view",{staticClass:"mask"},[t.uploadErrStatus[i]&&0!=t.uploadErrStatus[i]?t._e():e("text",{staticClass:"progress"},[e("text",{staticClass:"num"},[t._v(t._s(t.progressAll[i]))]),t._v("%")]),!0===t.uploadErrStatus[i]?e("text",{staticClass:"err"},[t._v(t._s(t.errTips[i]))]):t._e()])]):t._e()}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"choose_img",attrs:{eventid:"3f57b723-13"},on:{tap:function(s){s.stopPropagation(),t.chooseImg("kitchen")}}},[e("text",{staticClass:"iconfont icon-jia"})]):t._e()],2)]),e("view",{staticClass:"bedroom-box"},[e("view",{staticClass:"top-bedroom"},[e("text",{staticStyle:{"font-weight":"700"}},[t._v("其他")]),e("view",{staticClass:"example"},[t._v("范例"),e("text",{staticClass:"iconfont"},[t._v("")])])]),e("view",{staticClass:"hint-bedroom"},[t._v("建议上传。可以是其他室内空间、物件、小区周边环境等。更多的照片往往能吸引更多的房客。")]),e("view",{staticClass:"image_wrap"},[t._l(t.pics,function(s,i){return t.pics.length>0&&"other"===s.type?e("view",{key:i,staticClass:"img_item",attrs:{eventid:"3f57b723-15-"+i},on:{tap:function(e){e.stopPropagation(),t.previewPic(s)}}},[e("image",{attrs:{src:t.host+s.val}}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"del_img",attrs:{eventid:"3f57b723-14-"+i},on:{tap:function(s){s.stopPropagation(),t.del_img(i)}}},[e("text",{staticClass:"iconfont icon-duomeitiicon-"})]):t._e()]):t._e()}),t._l(t.temporaryUpload,function(s,i){return t.temporaryUpload.length>0&&t.isUploading&&"other"===t.curUploadType?e("view",{key:s.path,staticClass:"img_item2"},[e("image",{attrs:{src:s.path}}),e("view",{staticClass:"mask"},[t.uploadErrStatus[i]&&0!=t.uploadErrStatus[i]?t._e():e("text",{staticClass:"progress"},[e("text",{staticClass:"num"},[t._v(t._s(t.progressAll[i]))]),t._v("%")]),!0===t.uploadErrStatus[i]?e("text",{staticClass:"err"},[t._v(t._s(t.errTips[i]))]):t._e()])]):t._e()}),-1==t.houseStatus||2==t.houseStatus?e("view",{staticClass:"choose_img",attrs:{eventid:"3f57b723-16"},on:{tap:function(s){s.stopPropagation(),t.chooseImg("other")}}},[e("text",{staticClass:"iconfont icon-jia"})]):t._e()],2)]),t.setMainPicShow?e("view",{staticClass:"main-pics-model"},[e("scroll-view",{staticClass:"hengPics-wrap",attrs:{"scroll-y":""}},[e("view",{staticClass:"title"},[t._v("请选择一张照片作为首图")]),e("view",{staticClass:"hengPics-list"},t._l(t.hengPics,function(s,i){return 1===s.is_transverse?e("view",{key:i,staticClass:"hengPics-item",attrs:{eventid:"3f57b723-17-"+i},on:{tap:function(s){s.stopPropagation(),t.checkMainPic(i)}}},[e("image",{attrs:{src:t.host+s.val}}),t.curCheckMain===i?e("view",{staticClass:"check-on"},[e("text",{staticClass:"iconfont icon-gou"})]):t._e()]):t._e()})),e("button",{staticClass:"my-btn-block set-btn",class:{dis_btn:""===t.curCheckMain},attrs:{eventid:"3f57b723-18"},on:{tap:function(s){s.stopPropagation(),t.setMainPic(t.curCheckMain)}}},[t._v("设为首图")]),e("text",{staticClass:"close-btn iconfont icon-quxiao",attrs:{eventid:"3f57b723-19"},on:{tap:function(s){s.stopPropagation(),t.MainPicModelHide()}}})],1)],1):t._e()])},a=[];e.d(s,"a",function(){return i}),e.d(s,"b",function(){return a})},"76b4":function(t,s,e){"use strict";var i=e("8d64"),a=e.n(i);a.a},"777c":function(t,s,e){"use strict";var i=e("689a"),a=e.n(i);a.a},"8d64":function(t,s,e){},cac5:function(t,s,e){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=e("2f62"),a=e("942f"),o=c(e("8534")),n=e("3c10");function c(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var s=1;s<arguments.length;s++){var e=null!=arguments[s]?arguments[s]:{},i=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.forEach(function(s){l(t,s,e[s])})}return t}function l(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}var u={data:function(){return{host:n.shortHttp,house_id:"",pics:[],bedRoomImages:[],liveRoomImages:[],toiletImages:[],kitchenImages:[],otherImages:[],temporaryUpload:[],isUploading:!1,curUploadType:"",progressAll:[],uploadErrStatus:[],errTips:[],upLoadSuccessStatus:[],successTimer:null,uploadTotal:0,curUploadNum:0,uploadIsComplete:!1,uploadSuccessPic:[],isDeling:!1,isSetMaining:!1,houseStatus:"",mainPic:"",setMainPicList:[],curCheckMain:"",setMainPicShow:!1,hengPics:[]}},onLoad:function(){this.getCurData()},onShow:function(){},onBackPress:function(){return this.setMainPicShow?(this.MainPicModelHide(),!0):this.isUploading?(t.showModal({title:"提示",content:"图片上传中,禁止操作",showCancel:!1,confirmText:"知道了",success:function(t){}}),!0):void 0},computed:r({},(0,i.mapState)(["releaseObj"])),methods:r({},(0,i.mapMutations)(["editReleaseInfo","clearReleaseInfo","editReleaseInfoStatus"]),{MainPicModelShow:function(){if(this.isUploading)o.default.layer("图片正在上传中..");else if(!this.isDeling&&!this.isSetMaining){var t=this,s=!1;t.hengPics.forEach(function(t){1===t.is_transverse&&(s=!0)}),s&&(this.setMainPicShow=!0)}},MainPicModelHide:function(){this.setMainPicShow=!1},checkMainPic:function(t){var s=this;s.curCheckMain=t},chooseImg:function(s){if(this.isUploading)o.default.layer("图片正在上传中..");else if(!this.isDeling&&!this.isSetMaining){var e=this;e.init(),t.chooseImage({count:9,sizeType:["original"],sourceType:["album","camera"],success:function(t){var i=t.tempFiles;e.uploadTotal=i.length,e.isUploading=!0,e.curUploadType=s,e.temporaryUpload=i,i.forEach(function(t,i){var a=t.path;e.progressAll[i]=0,e.uploadErrStatus[i]=!1,e.upLoadSuccessStatus[i]=!1,e.uploadImg(a,i,s)})}})}},uploadImg:function(s,e,i){var a=this,o=t.getStorageSync("dz_token"),n=t.uploadFile({url:"http://dz.abontest.com/wap/api/upload.php",filePath:s,name:"file",header:{Authorization:"Bearer "+o},success:function(t){var s=JSON.parse(t.data);if("success"===s.status){var i=Object.assign(s.content,{index:e});a.uploadSuccessPic.push(i)}else a.$set(a.errTips,e,s.errorMsg),a.$set(a.uploadErrStatus,e,!0)},fail:function(t){a.$set(a.errTips,e,"上传发生异常"),a.$set(a.uploadErrStatus,e,!0),a.curUploadNum===a.uploadTotal&&(a.isUploading=!1)},complete:function(t){if(a.$set(a.upLoadSuccessStatus,e,!0),a.$set(a,"curUploadNum",a.curUploadNum+1),a.curUploadNum===a.uploadTotal){var s=a.picsSort(i);a.savePics(s)}}});n.onProgressUpdate(function(t){a.$set(a.progressAll,e,t.progress)})},setMainPic:function(t){var s=this,e=s.hengPics[t],i=s.house_id;if(!s.isDeling&&!s.isSetMaining)if(s.isUploading)o.default.layer("图片上传中,不能设置...");else if(1!==e.is_main)if(1!==e.is_transverse)o.default.layer("非横图,不能设置为首图");else{var n=JSON.parse(JSON.stringify(s.pics));n.map(function(t,s,e){e[s]["is_main"]=0}),n[t].is_main=1,s.isSetMaining=!0;var c={house_id:i,pictures:JSON.stringify(n)};s.MainPicModelHide(),(0,a.request)({url:"/wap/api/fangdong.php?action=improveHouse",method:"POST",data:c,success:function(t){if("success"===t.data.status){var e=t.data.content;s.editReleaseInfo(e),s.editReleaseInfoStatus(!0)}else o.default.layer("设置失败!")},complete:function(){s.isSetMaining=!1,s.getCurData()}})}else s.isSetMaining=!0},previewPic:function(s){var e=this;t.previewImage({current:e.host+s.path,urls:[e.host+s.path]})},del_img:function(s){var e=this,i=e.house_id;e.isDeling||e.isSetMaining||(e.isUploading?o.default.layer("图片上传中,不能进行删除操作..."):t.showModal({title:"",content:"是否删除这张图片",confirmText:"删除",success:function(n){if(n.confirm){e.isDeling=!0;var c=e.pics.slice();c.splice(s,1);var r={house_id:i,pictures:JSON.stringify(c)};t.showLoading({title:"删除中...",mask:!0}),(0,a.request)({url:"/wap/api/fangdong.php?action=improveHouse",method:"POST",data:r,success:function(t){if("success"===t.data.status){var s=t.data.content;e.editReleaseInfo(s),e.editReleaseInfoStatus(!0),e.getCurData()}else o.default.layer("删除图片失败")},complete:function(){e.isDeling=!1,t.hideLoading()}})}else n.cancel}}))},savePics:function(t){var s=this;t&&0!==t.length||(s.successTimer=setTimeout(function(){s.isUploading=!1,clearTimeout(s.successTimer),s.successTimer=null},1e3));var e=s.pics.slice(0),i=s.house_id,n=e.concat(t),c={house_id:i,pictures:JSON.stringify(n)};(0,a.request)({url:"/wap/api/fangdong.php?action=improveHouse",method:"POST",data:c,success:function(t){if("success"===t.data.status){var e=t.data.content;s.editReleaseInfo(e),s.editReleaseInfoStatus(!0)}else o.default.layer("照片上传失败")},complete:function(){s.successTimer=setTimeout(function(){s.isUploading=!1,s.getCurData(),clearTimeout(s.successTimer),s.successTimer=null},1e3)}})},hasMainPics:function(){var t=this,s=t.pics.slice(0);if(s.length>0)for(var e=0;e<s.length;e++)if(1==s[e].is_main)return!0;return!1},picsSort:function(t){var s=this,e=s.uploadSuccessPic;return e.sort(function(t,s){return t.index-s.index}),e.forEach(function(s){s.hasOwnProperty("index")&&(s["is_main"]=0,s["type"]=t,s["val"]=s.path,delete s.index)}),e},init:function(){var t=this;t.progressAll=[],t.temporaryUpload=[],t.uploadErrStatus=[],t.errTips=[],t.upLoadSuccessStatus=[],t.uploadIsComplete=!1,t.uploadTotal=0,t.curUploadNum=0,t.uploadSuccessPic=[],t.success_pics=[]},getCurData:function(){var t=this,s=this.releaseObj;this.house_id=s.id,this.houseStatus=s.status;var e=s.pics?s.pics:[],i="";this.pics=e,e.forEach(function(s,e){1===s.is_main&&(i=s.path,t.curCheckMain=e)}),this.mainPic=i,this.hengPics=JSON.parse(JSON.stringify(e)),console.log(this.hengPics)}})};s.default=u}).call(this,e("6e42")["default"])}},[["3338","common/runtime","common/vendor"]]]);